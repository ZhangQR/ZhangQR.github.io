<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-latter1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/04/latter1/" class="article-date">
  <time datetime="2019-07-03T16:12:00.000Z" itemprop="datePublished">2019-07-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/04/latter1/">Letter from an Unknown Woman</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Now I have only you left in the world;<br>　　Only you, who have never known me,<br>　　and whom I have never ceased to love.</p>
</blockquote>
<p>R. 最著名的小说家刚结束他在山上的一个短暂的假期。他清晨很早就到达了维也纳，并且买了一份报纸在车站，当他看到日期的时候才意识到今天是他的生日“41”，他突然想到。对此R.并没有很开心，也没有很遗憾，他找了一辆出租，并且在回去的路上快速扫了一遍。他的管家报告说：“在他不在的期间，除了一些电话之外，还有几个拜访者，还有一大捆信在等着他。他对这些漠不关心，并打开了一到两封，因为对寄信人感兴趣。同时把一个超大的信来自一个奇怪的笔迹放在一旁。R. 惬意的坐在椅子里，喝着他的早茶，看完报纸，又读了几则传单，然后，他点了一支雪茄，转身去看剩下的信件。<br>　　这是一封手稿而不是普通的信件，它包含了吉大女士笔迹匆忙写下的信纸，她不由自主的多次检查这个信封，以防他可能忽视被盖住的一页，但它并不是那样，在信封上或者目录上，即没有署名也没有地址。“真奇怪”他想，同时他开始读信。第一句话是标题。<br>　　“对你而言，从来都不知道我是谁”R. 很疑惑，这是专门寄给他的信，还是寄给某个人想象中的人？他的好奇心瞬间被唤起，他继续读着：<br>　　我的孩子昨天死了。我为了这个虚弱的小生命与死神斗争录入三天三夜，流行性感冒带的发烧折磨了他整整40个小时。期间，我一直坐在他床边陪着他，我将冷绷带放在了他的额头上，过了一天又一夜，一夜又一天，我一直抓着他不安的小手，第三天晚上，我的力气耗尽了，我没意识到自己闭上了眼睛，并且我一定在硬板凳上睡了三到四个小时，那时，死神带走了他。我亲爱的孩子，他躺在狭窄的婴儿床内，就像刚离开的样子，他那聪明的，黑色的眼睛永远闭上了，他的双手交叉放在胸前。四只蜡烛在床的四角燃烧，我不忍去看，不忍去移动，因为当蜡烛在闪烁，阴影投射在他的脸上，投射在他紧闭的嘴唇上，一个追逐另一个。这看起来像是他的，面容在动，然后我几乎可以幻想，他根本就没有死，他会醒来并且用清晰地声音诉说着孩子气的爱。但是我知道他死了，我在也看不到那个场景了。我不止一次的乞求，却又一次次的失望。我知道，我的孩子，在昨天死了。在这个世上，我只剩下你了。你，不知道我是谁；你，毫无察觉的享乐；你，与其他人冒险。只剩你了，一个从来不知道我是谁，我却从未停止去爱的人。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/04/latter1/" data-id="cjxo5fbdz000bskzz0ovnaiih" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/english/">english</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reading/">reading</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-TCP-IP-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/TCP-IP-1/" class="article-date">
  <time datetime="2019-06-24T03:11:31.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/TCP-IP-1/">《TCP/IP 详解》whois 试验</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这里有一个ip地址为：47.90.78.76</p>
<p>地址栏输入：<a href="http://whois.arin.net/rest/ip/47.90.78.76.txt" target="_blank" rel="noopener">http://whois.arin.net/rest/ip/47.90.78.76.txt</a></p>
<p>查询结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">#</span><br><span class="line"># ARIN WHOIS data and services are subject to the Terms of Use</span><br><span class="line"># available at: https://www.arin.net/resources/registry/whois/tou/</span><br><span class="line">#</span><br><span class="line"># If you see inaccuracies in the results, please report at</span><br><span class="line"># https://www.arin.net/resources/registry/whois/inaccuracy_reporting/</span><br><span class="line">#</span><br><span class="line"># Copyright 1997-2019, American Registry for Internet Numbers, Ltd.</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line">NetRange:       47.90.0.0 - 47.90.127.255</span><br><span class="line">CIDR:           47.90.0.0/17</span><br><span class="line">NetName:        ALICLOUD-HK</span><br><span class="line">NetHandle:      NET-47-90-0-0-1</span><br><span class="line">Parent:         AL-3 (NET-47-88-0-0-1)</span><br><span class="line">NetType:        Reassigned</span><br><span class="line">OriginAS:       AS45102</span><br><span class="line">Customer:       ALICLOUD-HK (C06961495)</span><br><span class="line">RegDate:        2018-04-20</span><br><span class="line">Updated:        2018-04-20</span><br><span class="line">Comment:        1.For AliCloud IPR Infringement and Abuse Claim, please use below link with browser to report: https://intl.aliyun.com/report</span><br><span class="line">Comment:        </span><br><span class="line">Comment:        2.For Alibaba.com and Aliexpress.com&apos;s IPR Infringement , please use below link with browser to report: https://ipp.alibabagroup.com</span><br><span class="line">Comment:        </span><br><span class="line">Comment:        3.For Alibaba.com and Aliexpress.com&apos;s Abuse, please send email to those two mail lists to report: intl-abuse@list.alibaba-inc.com and abuse@alibaba-inc.com</span><br><span class="line">Comment:        </span><br><span class="line">Comment:        4. For network issue, please send email to this mail list: aliops-goc@list.alibaba-inc.com</span><br><span class="line">Ref:            https://whois.arin.net/rest/net/NET-47-90-0-0-1</span><br><span class="line"> </span><br><span class="line">#</span><br><span class="line"># ARIN WHOIS data and services are subject to the Terms of Use</span><br><span class="line"># available at: https://www.arin.net/resources/registry/whois/tou/</span><br><span class="line">#</span><br><span class="line"># If you see inaccuracies in the results, please report at</span><br><span class="line"># https://www.arin.net/resources/registry/whois/inaccuracy_reporting/</span><br><span class="line">#</span><br><span class="line"># Copyright 1997-2019, American Registry for Internet Numbers, Ltd.</span><br><span class="line">#</span><br></pre></td></tr></table></figure>

<p>可以看到该ip属于 47.90.0.0/17 地址块的，所以如果下面没有在划分，同样的主机有 2^15 个，所属状态是被分配，归属ALICLOUD-HK（香港阿里云）。这个地址块属于 AL-3 (NET-47-88-0-0-1)，所以继续往上查询。</p>
<p>地址栏输入：<a href="http://whois.arin.net/rest/net/NET-47-88-0-0-1.txt" target="_blank" rel="noopener">http://whois.arin.net/rest/net/NET-47-88-0-0-1.txt</a></p>
<p>查询结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">#</span><br><span class="line"># ARIN WHOIS data and services are subject to the Terms of Use</span><br><span class="line"># available at: https://www.arin.net/resources/registry/whois/tou/</span><br><span class="line">#</span><br><span class="line"># If you see inaccuracies in the results, please report at</span><br><span class="line"># https://www.arin.net/resources/registry/whois/inaccuracy_reporting/</span><br><span class="line">#</span><br><span class="line"># Copyright 1997-2019, American Registry for Internet Numbers, Ltd.</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line">NetRange:       47.88.0.0 - 47.91.255.255</span><br><span class="line">CIDR:           47.88.0.0/14</span><br><span class="line">NetName:        AL-3</span><br><span class="line">NetHandle:      NET-47-88-0-0-1</span><br><span class="line">Parent:         NET47 (NET-47-0-0-0-0)</span><br><span class="line">NetType:        Direct Allocation</span><br><span class="line">OriginAS:       </span><br><span class="line">Organization:   Alibaba.com LLC (AL-3)</span><br><span class="line">RegDate:        2015-05-18</span><br><span class="line">Updated:        2017-04-26</span><br><span class="line">Ref:            https://whois.arin.net/rest/net/NET-47-88-0-0-1</span><br><span class="line"> </span><br><span class="line">#</span><br><span class="line"># ARIN WHOIS data and services are subject to the Terms of Use</span><br><span class="line"># available at: https://www.arin.net/resources/registry/whois/tou/</span><br><span class="line">#</span><br><span class="line"># If you see inaccuracies in the results, please report at</span><br><span class="line"># https://www.arin.net/resources/registry/whois/inaccuracy_reporting/</span><br><span class="line">#</span><br><span class="line"># Copyright 1997-2019, American Registry for Internet Numbers, Ltd.</span><br><span class="line">#</span><br></pre></td></tr></table></figure>

<p>可以看到前缀又变短了，这个地址块可以容纳 2^18 个主机，所属组织依然是阿里。继续往上查询</p>
<p>地址栏输入：<a href="http://whois.arin.net/rest/net/NET-47-0-0-0-0.txt" target="_blank" rel="noopener">http://whois.arin.net/rest/net/NET-47-0-0-0-0.txt</a></p>
<p>查询结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">#</span><br><span class="line"># ARIN WHOIS data and services are subject to the Terms of Use</span><br><span class="line"># available at: https://www.arin.net/resources/registry/whois/tou/</span><br><span class="line">#</span><br><span class="line"># If you see inaccuracies in the results, please report at</span><br><span class="line"># https://www.arin.net/resources/registry/whois/inaccuracy_reporting/</span><br><span class="line">#</span><br><span class="line"># Copyright 1997-2019, American Registry for Internet Numbers, Ltd.</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line">NetRange:       47.0.0.0 - 47.255.255.255</span><br><span class="line">CIDR:           47.0.0.0/8</span><br><span class="line">NetName:        NET47</span><br><span class="line">NetHandle:      NET-47-0-0-0-0</span><br><span class="line">Parent:          ()</span><br><span class="line">NetType:        Early Registrations, Maintained by ARIN</span><br><span class="line">OriginAS:       </span><br><span class="line">Organization:   American Registry for Internet Numbers (ARIN)</span><br><span class="line">RegDate:        1989-01-06</span><br><span class="line">Updated:        2012-02-29</span><br><span class="line">Ref:            https://whois.arin.net/rest/net/NET-47-0-0-0-0</span><br><span class="line"> </span><br><span class="line">#</span><br><span class="line"># ARIN WHOIS data and services are subject to the Terms of Use</span><br><span class="line"># available at: https://www.arin.net/resources/registry/whois/tou/</span><br><span class="line">#</span><br><span class="line"># If you see inaccuracies in the results, please report at</span><br><span class="line"># https://www.arin.net/resources/registry/whois/inaccuracy_reporting/</span><br><span class="line">#</span><br><span class="line"># Copyright 1997-2019, American Registry for Internet Numbers, Ltd.</span><br><span class="line">#</span><br></pre></td></tr></table></figure>

<p>前缀变为8，也就是一个 A 类网络。所属于 ARIN，也就是美洲 internet 号码注册机构。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/24/TCP-IP-1/" data-id="cjxo5fbdu0006skzznkak78mn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">-网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-flush-problem" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/12/flush-problem/" class="article-date">
  <time datetime="2019-06-12T10:55:23.000Z" itemprop="datePublished">2019-06-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/12/flush-problem/">BufferedOutputStream 和 OutputStream</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="问题引入"><a href="#问题引入" class="headerlink" title="问题引入"></a>问题引入</h3><p>在写 TCP 上传图片上时，发现如果使用 BufferedOutputStream 发送一条短信息，如果没有 flush，则对面就会一直等待。进而发现，服务端收到的图片大小也要小于客户端所发送的。   </p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SocketTest;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PicTcpClient</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Socket s=<span class="keyword">new</span> Socket(<span class="string">"localhost"</span>,<span class="number">10003</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户端输入流</span></span><br><span class="line">		<span class="comment">//BufferedInputStream bufIn=new BufferedInputStream(s.getInputStream());</span></span><br><span class="line">		InputStream bufIn=s.getInputStream();</span><br><span class="line">		<span class="comment">//文件写入流</span></span><br><span class="line">		<span class="comment">//BufferedInputStream fIn=new BufferedInputStream(</span></span><br><span class="line">				<span class="comment">//new FileInputStream("C:\\Users\\54560\\Desktop\\新建文件夹\\1.jpg"));</span></span><br><span class="line">		InputStream fIn=</span><br><span class="line">			<span class="keyword">new</span> FileInputStream(<span class="string">"C:\\Users\\54560\\Desktop\\新建文件夹\\1.jpg"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//socket输出流</span></span><br><span class="line">		BufferedOutputStream bufOut=<span class="keyword">new</span> BufferedOutputStream(s.getOutputStream());</span><br><span class="line">		<span class="comment">//OutputStream bufOut=s.getOutputStream();</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">byte</span>[] buf=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((len=fIn.read(buf))!=-<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			bufOut.write(buf,<span class="number">0</span>,len);</span><br><span class="line">			System.out.println(++i);</span><br><span class="line"> </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//bufOut.flush();</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//告诉服务端你已经上传完毕</span></span><br><span class="line">		s.shutdownOutput();</span><br><span class="line">		System.out.println(<span class="string">"客户端上传完毕"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//用来接收服务端传来的数据</span></span><br><span class="line">		<span class="keyword">byte</span>[] bufin=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> in_len=<span class="number">0</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//接收服务端传来的上传成功字段</span></span><br><span class="line">		in_len=bufIn.read(bufin);</span><br><span class="line">		System.out.println(<span class="string">"客户端读到数据:"</span>+<span class="keyword">new</span> String(bufin,<span class="number">0</span>,in_len));</span><br><span class="line">		</span><br><span class="line">		fIn.close();</span><br><span class="line">		s.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SocketTest;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传一张图片给服务器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 神奇女侠</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PicTcpServer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ServerSocket ss=<span class="keyword">new</span> ServerSocket(<span class="number">10003</span>);</span><br><span class="line">		</span><br><span class="line">		Socket s=ss.accept();</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"一个客户端已连接:"</span>+s.getInetAddress().getHostAddress());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户端输入流</span></span><br><span class="line">		<span class="comment">//BufferedInputStream bufIn=new BufferedInputStream(s.getInputStream());</span></span><br><span class="line">		InputStream bufIn=s.getInputStream();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户端输出流</span></span><br><span class="line">		BufferedOutputStream bufOut=<span class="keyword">new</span> BufferedOutputStream(s.getOutputStream());</span><br><span class="line">		<span class="comment">//OutputStream bufOut=s.getOutputStream();</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建文件输入流</span></span><br><span class="line">		FileOutputStream fout=<span class="keyword">new</span> FileOutputStream(<span class="string">"serve.jpg"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//存储客户端传来的数据缓冲区</span></span><br><span class="line">		<span class="keyword">byte</span>[] buf_in=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> len_in=<span class="number">0</span>;</span><br><span class="line">		<span class="comment">//int i=0;</span></span><br><span class="line">		<span class="keyword">while</span>((len_in=bufIn.read(buf_in))!=-<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//将客户端传过来的数据写到文件中</span></span><br><span class="line">			fout.write(buf_in,<span class="number">0</span>,len_in);</span><br><span class="line">			<span class="comment">//System.out.println(++i);</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//文件写入完毕告诉客户端，接收完成</span></span><br><span class="line">		bufOut.write(<span class="string">"接收完毕"</span>.getBytes());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//关闭文件流</span></span><br><span class="line">		fout.close();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//断开客户端的连接</span></span><br><span class="line">		s.close();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//关闭服务器</span></span><br><span class="line">		System.out.println(<span class="string">"服务器即将关闭"</span>);</span><br><span class="line">		ss.close();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：<br><img src="/img/flush_1.png" alt><br><img src="/img/flush_2.png" alt><br>分析：这里服务端直接发送完“接收完毕”就关闭了，但是客户端却一直没有收到信息，并且图片大小应该是将近 39k，但 serve.jpg 却只有 32k(而且是整 32k，引人深思啊~)</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>经过试验，得到两种解决方法。</p>
<blockquote>
<p>方法一：把 Buffered 全部去掉<br>方法二：客户端在 while 外面 flush 一次，服务端在发送“接收完毕”之后 flush 一下  </p>
</blockquote>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>BufferedOutputStream 在内部有一个缓冲区，当缓冲区满了，就会自动发送，而 flush 的作用是在缓冲区没满的时候也强制发送。服务端接收的图片过小的原因就是，最后有一部分图片在客户端的 Socket 输出流中的缓冲区中，没有被 flush。证明如下：</p>
<p><img src="/img/flush_3.png" alt></p>
<p><img src="/img/flush_4.png" alt></p>
<p>可以看到，客户端的 while 执行了 39 次，因为图片实际大小为 39k 左右，但是服务端只执行了 32 次，因为第 33-39 次的数据还在缓冲区，没有被 flush。个人理解：如果说传输数据是一条河，A 为客户端，B 为服务端。A 使用了 Buffered 的话，就相当于在己方设置了一道闸，当数据达到 8KB(这个值只是为了方便举例)时，闸就会打开，将 8KB 放出去，B 那里也有一个闸，并且设置了一个 1KB 的数组用来接收数据，read 一次，就是开闸放1KB进来存到数据中，处理完毕之后再开闸，如果河道中没有数据，那就等待。所以上述情况就是因为 33k-39k 数据不满 8k，所以在 A 的闸内没有流到河道中来。所以可以手动开闸(即 flush)，将这些数据释放，或者一开始就用 OutputStream，即一开始就没有闸。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>1、流关闭前会自动调用一次 flush，但 Socket 断开连接时，是不会将输入输出流也断开的(一开始理所当然的认为会一起断开，所以一直没发现是因为需要手动 flush)，如果后面用不到流的话，flush 那里换成 close 也是可以的。<br>2、BufferedOutputStream 只有在缓冲区满的时候才会操作，所以注意不要遗忘缓冲区内的未被flush的数据。  </p>
</blockquote>
<p>最后附上完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SocketTest;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传一张图片给服务器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 神奇女侠</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PicTcpServer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ServerSocket ss=<span class="keyword">new</span> ServerSocket(<span class="number">10003</span>);</span><br><span class="line">		</span><br><span class="line">		Socket s=ss.accept();</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"一个客户端已连接:"</span>+s.getInetAddress().getHostAddress());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户端输入流</span></span><br><span class="line">		<span class="comment">//BufferedInputStream bufIn=new BufferedInputStream(s.getInputStream());</span></span><br><span class="line">		InputStream bufIn=s.getInputStream();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户端输出流</span></span><br><span class="line">		BufferedOutputStream bufOut=<span class="keyword">new</span> BufferedOutputStream(s.getOutputStream());</span><br><span class="line">		<span class="comment">//OutputStream bufOut=s.getOutputStream();</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建文件输入流</span></span><br><span class="line">		FileOutputStream fout=<span class="keyword">new</span> FileOutputStream(<span class="string">"serve.jpg"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//存储客户端传来的数据缓冲区</span></span><br><span class="line">		<span class="keyword">byte</span>[] buf_in=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> len_in=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((len_in=bufIn.read(buf_in))!=-<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//将客户端传过来的数据写到文件中</span></span><br><span class="line">			fout.write(buf_in,<span class="number">0</span>,len_in);</span><br><span class="line">			System.out.println(++i);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//文件写入完毕告诉客户端，接收完成</span></span><br><span class="line">		bufOut.write(<span class="string">"接收完毕"</span>.getBytes());</span><br><span class="line">		bufOut.flush();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//关闭文件流</span></span><br><span class="line">		fout.close();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//断开客户端的连接</span></span><br><span class="line">		s.close();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//关闭服务器</span></span><br><span class="line">		System.out.println(<span class="string">"服务器即将关闭"</span>);</span><br><span class="line">		ss.close();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SocketTest;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PicTcpClient</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Socket s=<span class="keyword">new</span> Socket(<span class="string">"localhost"</span>,<span class="number">10003</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户端输入流</span></span><br><span class="line">		<span class="comment">//BufferedInputStream bufIn=new BufferedInputStream(s.getInputStream());</span></span><br><span class="line">		InputStream bufIn=s.getInputStream();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//文件写入流</span></span><br><span class="line">		<span class="comment">//BufferedInputStream fIn=new BufferedInputStream(</span></span><br><span class="line">				<span class="comment">//new FileInputStream("C:\\Users\\54560\\Desktop\\新建文件夹\\1.jpg"));</span></span><br><span class="line">		InputStream fIn=</span><br><span class="line">			<span class="keyword">new</span> FileInputStream(<span class="string">"C:\\Users\\54560\\Desktop\\新建文件夹\\1.jpg"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//socket输出流</span></span><br><span class="line">		BufferedOutputStream bufOut=<span class="keyword">new</span> BufferedOutputStream(s.getOutputStream());</span><br><span class="line">		<span class="comment">//OutputStream bufOut=s.getOutputStream();</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">byte</span>[] buf=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((len=fIn.read(buf))!=-<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			bufOut.write(buf,<span class="number">0</span>,len);</span><br><span class="line">			System.out.println(++i);</span><br><span class="line"> </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		bufOut.flush();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//告诉服务端你已经上传完毕</span></span><br><span class="line">		s.shutdownOutput();</span><br><span class="line">		System.out.println(<span class="string">"客户端上传完毕"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//用来接收服务端传来的数据</span></span><br><span class="line">		<span class="keyword">byte</span>[] bufin=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> in_len=<span class="number">0</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//接收服务端传来的上传成功字段</span></span><br><span class="line">		in_len=bufIn.read(bufin);</span><br><span class="line">		System.out.println(<span class="string">"客户端读到数据:"</span>+<span class="keyword">new</span> String(bufin,<span class="number">0</span>,in_len));</span><br><span class="line">		</span><br><span class="line">		fIn.close();</span><br><span class="line">		s.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>如有错误，请多指教</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/12/flush-problem/" data-id="cjxo5fbdv0007skzzq2w9ml94" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-网络/">-Java -网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-singleton" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/26/singleton/" class="article-date">
  <time datetime="2019-04-26T03:06:49.000Z" itemprop="datePublished">2019-04-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/26/singleton/">单例模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>单例模式要点：</p>
<ul>
<li>构造函数私有化</li>
<li>保证只会实例化一个对象</li>
</ul>
<h3 id="种类"><a href="#种类" class="headerlink" title="种类"></a>种类</h3><h4 id="饱汉式"><a href="#饱汉式" class="headerlink" title="饱汉式"></a>饱汉式</h4><p>优点：实现简单，安全<br>缺点：唯一的对象在类本身完成实例化的时候就会被构造，但如果从未使用过这个对象，就会造成内存浪费。<br>比如下面代码，只是使用了静态方法，未使用过对象，但对象也被构造了，并且会自始至终都存在。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//饱汉式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	 <span class="comment">//构造函数私有化</span></span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">     </span>&#123;</span><br><span class="line">    	 System.out.println(<span class="string">"构造函数被调用"</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//将唯一的对象设置为常量</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> SingleTon INSTANCE=<span class="keyword">new</span> SingleTon();</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//提供获取对象的外部接口</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">     </span>&#123;</span><br><span class="line">    	 <span class="keyword">return</span> INSTANCE;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span></span><br><span class="line"><span class="function">     </span>&#123;</span><br><span class="line">    	 System.out.println(<span class="string">"method方法被调用"</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		SingleTon.method();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<blockquote>
<p>构造函数被调用<br>method方法被调用</p>
</blockquote>
<h4 id="懒汉式-不可用"><a href="#懒汉式-不可用" class="headerlink" title="懒汉式[不可用]"></a>懒汉式[不可用]</h4><p>优点：实现了 Lazy Loading，在下面代码中可以看出，不使用 INSTANCE 的时候 INSTANCE 是不会初始化的。<br>缺点：多线程下不安全，如果线程 A 进入了 if(INSTANCE == null) 的判断后被打断，线程B又进入了 if(INSTANCE == null) ，并且继续执行，这时已经实例化了一个对象。A 再回来执行时，因为已经判断过了，所以又实例化了一个对象，就违反了单例的原则。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"构造函数被调用"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SingleTon INSTANCE;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">if</span>(INSTANCE==<span class="keyword">null</span>)</span><br><span class="line">    	&#123;</span><br><span class="line">    		INSTANCE=<span class="keyword">new</span> SingleTon();</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	System.out.println(<span class="string">"method方法被调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleTon</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		SingleTon.method();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<blockquote>
<p>method方法被调用</p>
</blockquote>
<h4 id="懒汉式双重判断"><a href="#懒汉式双重判断" class="headerlink" title="懒汉式双重判断"></a>懒汉式双重判断</h4><p>针对懒汉式线程不安全问题有一个逐步的完善过程，双重判断是最终可用并且不影响效率的版本<br>优点：Lazy Loading 并且线程安全<br>缺点：书写麻烦(如果算的话)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SingleTon INSTANCE;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>)</span><br><span class="line">			<span class="keyword">synchronized</span> (SingleTon.class) &#123;</span><br><span class="line">				<span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>)</span><br><span class="line">					INSTANCE = <span class="keyword">new</span> SingleTon();</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">return</span> INSTANCE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="内部静态类实现单例"><a href="#内部静态类实现单例" class="headerlink" title="内部静态类实现单例"></a>内部静态类实现单例</h4><p>优点：安全，高效，Lazy Loading</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTonInstance</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> SingleTon INSTANCE=<span class="keyword">new</span> SingleTon();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SingleTonInstance.INSTANCE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://www.cnblogs.com/zhaoyan001/p/6365064.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhaoyan001/p/6365064.html</a></p>
<p><em>如有错误，请多指教</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/26/singleton/" data-id="cjxo5fbee000iskzz4qtpy9mm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-Pattern/">-Java -Pattern</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-producer-and-consumer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/25/producer-and-consumer/" class="article-date">
  <time datetime="2019-04-25T09:47:35.000Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/producer-and-consumer/">生产者消费者问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生产者消费者问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> maxSize = <span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 存储数据</span></span><br><span class="line">		LinkedList&lt;Integer&gt; storage = <span class="keyword">new</span> LinkedList&lt;Integer&gt;();</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 创建生产者消费者</span></span><br><span class="line">		Productor p1 = <span class="keyword">new</span> Productor(storage, <span class="string">"1号生产者"</span>);</span><br><span class="line">		Productor p2 = <span class="keyword">new</span> Productor(storage, <span class="string">"2号生产者"</span>);</span><br><span class="line">		Productor p3 = <span class="keyword">new</span> Productor(storage, <span class="string">"3号生产者"</span>);</span><br><span class="line">		Consumer c1 = <span class="keyword">new</span> Consumer(storage, <span class="string">"1号消费者"</span>);</span><br><span class="line">		Consumer c2 = <span class="keyword">new</span> Consumer(storage, <span class="string">"2号消费者"</span>);</span><br><span class="line">		<span class="comment">//Consumer c3 = new Consumer(storage, "3号消费者");</span></span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 创建线程</span></span><br><span class="line">		Thread t1 = <span class="keyword">new</span> Thread(p1);</span><br><span class="line">		Thread t2 = <span class="keyword">new</span> Thread(p2);</span><br><span class="line">		Thread t3 = <span class="keyword">new</span> Thread(p3);</span><br><span class="line">		Thread t4 = <span class="keyword">new</span> Thread(c1);</span><br><span class="line">		Thread t5 = <span class="keyword">new</span> Thread(c2);</span><br><span class="line">		<span class="comment">//Thread t6 = new Thread(c3);</span></span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 开启线程</span></span><br><span class="line">		t1.start();</span><br><span class="line">		t2.start();</span><br><span class="line">		t3.start();</span><br><span class="line">		t4.start();</span><br><span class="line">		t5.start();</span><br><span class="line">		<span class="comment">//t6.start();</span></span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 生产者类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Productor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> String name;</span><br><span class="line">		<span class="keyword">private</span> List&lt;Integer&gt; list;</span><br><span class="line"> </span><br><span class="line">		<span class="function"><span class="keyword">private</span> <span class="title">Productor</span><span class="params">(List&lt;Integer&gt; list, String name)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.list = list;</span><br><span class="line">			<span class="keyword">this</span>.name = name;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">				<span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">					<span class="keyword">while</span> (list.size() &gt;= maxSize) &#123;</span><br><span class="line">						System.out.println(name + <span class="string">"因空间不足，无法生产，进入等待"</span>);</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							list.wait();</span><br><span class="line">						&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">							e.printStackTrace();</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">// 这里也可以随机生成一个数字当成是商品</span></span><br><span class="line">					list.add(<span class="number">1</span>);</span><br><span class="line">					System.out.println(name + <span class="string">"生产了1个商品,现库存:"</span> + list.size());</span><br><span class="line"> </span><br><span class="line">					<span class="comment">// 生产完成后唤醒所有等待线程</span></span><br><span class="line">					list.notifyAll();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 消费者类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> String name;</span><br><span class="line">		<span class="keyword">private</span> List&lt;Integer&gt; list;</span><br><span class="line"> </span><br><span class="line">		<span class="function"><span class="keyword">private</span> <span class="title">Consumer</span><span class="params">(List&lt;Integer&gt; list, String name)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.list = list;</span><br><span class="line">			<span class="keyword">this</span>.name = name;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">				<span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">					<span class="keyword">while</span> (list.size() == <span class="number">0</span>) &#123;</span><br><span class="line">						System.out.println(name + <span class="string">"因余量不足，无法消费，进入等待队列"</span>);</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							list.wait();</span><br><span class="line">						&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">							e.printStackTrace();</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">// 删除list的第一个元素</span></span><br><span class="line">					list.remove(<span class="number">0</span>);</span><br><span class="line">					System.out.println(name + <span class="string">"消费了一个商品，现库存："</span> + list.size());</span><br><span class="line"> </span><br><span class="line">					<span class="comment">// 消费完成后唤醒所有的线程</span></span><br><span class="line">					list.notifyAll();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中创建了 3 个生产者，2 个消费者，一直进行生产/消费行为。</p>
<p>并且设置仓储的最大容量为 10。</p>
<p>运行结果如下：</p>
<blockquote>
<p>1号生产者生产了1个商品,现库存:1<br>2号生产者生产了1个商品,现库存:2<br>2号消费者消费了一个商品，现库存：1<br>3号生产者生产了1个商品,现库存:2<br>1号消费者消费了一个商品，现库存：1<br>2号生产者生产了1个商品,现库存:2<br>1号生产者生产了1个商品,现库存:3<br>1号消费者消费了一个商品，现库存：2<br>2号消费者消费了一个商品，现库存：1<br>3号生产者生产了1个商品,现库存:2<br>1号生产者生产了1个商品,现库存:3<br>2号生产者生产了1个商品,现库存:4<br>3号生产者生产了1个商品,现库存:5<br>1号消费者消费了一个商品，现库存：4<br>2号消费者消费了一个商品，现库存：3<br>1号生产者生产了1个商品,现库存:4<br>2号生产者生产了1个商品,现库存:5<br>2号消费者消费了一个商品，现库存：4<br>3号生产者生产了1个商品,现库存:5<br>1号消费者消费了一个商品，现库存：4<br>1号生产者生产了1个商品,现库存:5<br>2号生产者生产了1个商品,现库存:6<br>2号消费者消费了一个商品，现库存：5<br>3号生产者生产了1个商品,现库存:6<br>1号消费者消费了一个商品，现库存：5<br>2号生产者生产了1个商品,现库存:6<br>1号生产者生产了1个商品,现库存:7<br>1号消费者消费了一个商品，现库存：6<br>3号生产者生产了1个商品,现库存:7<br>2号消费者消费了一个商品，现库存：6<br>2号生产者生产了1个商品,现库存:7<br>1号生产者生产了1个商品,现库存:8<br>2号消费者消费了一个商品，现库存：7<br>3号生产者生产了1个商品,现库存:8<br>1号消费者消费了一个商品，现库存：7<br>2号生产者生产了1个商品,现库存:8<br>1号生产者生产了1个商品,现库存:9<br>3号生产者生产了1个商品,现库存:10<br>2号消费者消费了一个商品，现库存：9<br>1号消费者消费了一个商品，现库存：8<br>2号生产者生产了1个商品,现库存:9<br>1号生产者生产了1个商品,现库存:10<br>2号消费者消费了一个商品，现库存：9<br>3号生产者生产了1个商品,现库存:10<br>1号消费者消费了一个商品，现库存：9<br>2号生产者生产了1个商品,现库存:10<br>1号生产者因空间不足，无法生产，进入等待<br>3号生产者因空间不足，无法生产，进入等待<br>2号消费者消费了一个商品，现库存：9<br>1号消费者消费了一个商品，现库存：8<br>3号生产者生产了1个商品,现库存:9<br>1号生产者生产了1个商品,现库存:10<br>2号生产者因空间不足，无法生产，进入等待<br>1号消费者消费了一个商品，现库存：9<br>2号生产者生产了1个商品,现库存:10<br>3号生产者因空间不足，无法生产，进入等待<br>1号生产者因空间不足，无法生产，进入等待<br>2号消费者消费了一个商品，现库存：9<br>1号生产者生产了1个商品,现库存:10<br>3号生产者因空间不足，无法生产，进入等待<br>……</p>
</blockquote>
<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><p>1、wait 外面一般要套用一个 while (条件判断)<br>如果不加，那么notify过早，线程会陷入等待；如果用 if(条件判断)，那么线程在判断条件后，进入等待；这时条件已经被更改，该线程被唤醒后会继续执行，而不会重新判断是否符合现在的条件。<br>2、应使用 notifyAll 而不是 notify<br>如果仓储已满，而被唤醒的一直是生产者，那么所有线程都将陷入等待。</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://www.jianshu.com/p/e29632593057" target="_blank" rel="noopener">https://www.jianshu.com/p/e29632593057</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/25/producer-and-consumer/" data-id="cjxo5fbed000gskzzoq5qg4jd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-OS/">-Java -OS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java-init" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/23/Java-init/" class="article-date">
  <time datetime="2019-04-23T15:23:13.000Z" itemprop="datePublished">2019-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/23/Java-init/">Java 初始化顺序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h3><h4 id="结论一"><a href="#结论一" class="headerlink" title="结论一"></a>结论一</h4><p>静态代码块并不一定初始化在静态成员前，两者顺序关系与代码的顺序有关，依据如下实验</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试类的初始化顺序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 神奇女侠</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//静态成员</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> MyTest t=<span class="keyword">new</span> MyTest();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//静态代码块</span></span><br><span class="line">	<span class="keyword">static</span></span><br><span class="line">	&#123;</span><br><span class="line">		System.out.println(<span class="string">"这里是MyTest类的静态代码块"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//构造函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"构造函数被执行"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//主函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<p>构造函数被执行<br>这里是MyTest类的静态代码块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试类的初始化顺序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 神奇女侠</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">	<span class="comment">//静态代码块</span></span><br><span class="line">	<span class="keyword">static</span></span><br><span class="line">	&#123;</span><br><span class="line">		System.out.println(<span class="string">"这里是MyTest类的静态代码块"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">//静态成员</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> MyTest t=<span class="keyword">new</span> MyTest();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//构造函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"构造函数被执行"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//主函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<p>这里是MyTest类的静态代码块<br>构造函数被执行</p>
<h4 id="结论二"><a href="#结论二" class="headerlink" title="结论二"></a>结论二</h4><p>内部类的静态代码块与静态成员的初始化顺序也与代码中的顺序有关</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">	<span class="comment">//静态代码块</span></span><br><span class="line">	<span class="keyword">static</span></span><br><span class="line">	&#123;</span><br><span class="line">		System.out.println(<span class="string">"这里是MyTest类的静态代码块"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">//静态成员</span></span><br><span class="line">	<span class="comment">//public static MyTest t=new MyTest();</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//构造函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"构造函数被执行"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//内部类</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">		<span class="comment">//内部类的静态代码块</span></span><br><span class="line">		<span class="keyword">static</span></span><br><span class="line">		&#123;</span><br><span class="line">			System.out.println(<span class="string">"这里是Inner类的静态代码块"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">			</span><br><span class="line">		<span class="comment">//静态成员</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> MyTest t=<span class="keyword">new</span> MyTest();</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Method</span><span class="params">()</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"Method()被执行"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//主函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		MyTest.Inner.Method();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<p>这里是MyTest类的静态代码块<br>这里是Inner类的静态代码块<br>构造函数被执行<br>Method()被执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">	<span class="comment">//静态代码块</span></span><br><span class="line">	<span class="keyword">static</span></span><br><span class="line">	&#123;</span><br><span class="line">		System.out.println(<span class="string">"这里是MyTest类的静态代码块"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">//静态成员</span></span><br><span class="line">	<span class="comment">//public static MyTest t=new MyTest();</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//构造函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"构造函数被执行"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//内部类</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//静态成员</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> MyTest t=<span class="keyword">new</span> MyTest();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//内部类的静态代码块</span></span><br><span class="line">		<span class="keyword">static</span></span><br><span class="line">		&#123;</span><br><span class="line">			System.out.println(<span class="string">"这里是Inner类的静态代码块"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">					</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Method</span><span class="params">()</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"Method()被执行"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//主函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		MyTest.Inner.Method();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里是MyTest类的静态代码块<br>构造函数被执行<br>这里是Inner类的静态代码块<br>Method()被执行</p>
<h4 id="结论三"><a href="#结论三" class="headerlink" title="结论三"></a>结论三</h4><p>类的使用需经过加载(将二进制文件，即.class文件加载进内存)，链接，初始化。静态代码块的执行与静态成员的初始化都在类的初始化时期；也就是说，类只有被使用时才会完成初始化。<br>分析：MyTest的静态代码块始终首先被执行，是因为jvm使用了MyTest内的main方法。所以MyTest在执行初的时候就完成了加载，链接，初始化三步。</p>
<p>而Inner可以理解为是MyTest的静态成员，应该在一开始就完成了初始化，但是Inner内的静态代码块却没有在MyTest的静态成员初始化的时候执行，说明这时的Inner只是完成了加载，链接两步。直到调用了Inner内的Method方法，Inner的初始化才被完成。    </p>
<h4 id="结论四"><a href="#结论四" class="headerlink" title="结论四"></a>结论四</h4><p>只有类完成初始化之后（加载，链接，初始化）,才可以new对象。new对象的初始化顺序为：构造代码块，成员变量初始化，构造函数（先父后子）</p>
<p>总结：类的初始化与对象的初始化是不一样的，也就可以理解为什么静态的只会执行一次，而非静态new多少次就执行多少次。因为静态的初始化是在类本身的初始化时期进行的，与对象的初始化不同。     </p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>引用一下别人的总结：</p>
<blockquote>
<p>顺序是：父类静态属性-&gt;父类静态代码块-&gt;子类静态变量-&gt;子类静态代码块-&gt;父类非静态变量-&gt;父类非静态代码块-&gt;父类构造函数-&gt;子类非静态变量-&gt;子类非静态代码块-&gt;子类构造函数<br>这样的加载顺序不是绝对的 因为静态变量和静态代码块跟声明顺序有关。<br>对于如果静态代码块中调用静态变量，那么静态变量必须在静态代码块前面声明；如果静态代码块中没有调用静态变量，那么就跟顺序有关了，谁先声明谁先被加载。说白了还是顺序加载，之所以会出现“如果静态代码块中调用静态变量，那么静态变量必须在静态代码块前面声明”，是因为变量是声明，所以出现编译错误。<br>应用到内部类中 静态变量和静态代码块跟声明顺序有关。 这样就可以解释你的问题了。内部类也是类。<br>测试所用jdk版本1.8.0_20<br>类静态块-类静态属性这个跟顺序有关系 如果类静态属性在类静态代码块之前 那么类静态属性先初始化</p>
</blockquote>
<h3 id="Reference："><a href="#Reference：" class="headerlink" title="Reference："></a>Reference：</h3><p><a href="https://www.oschina.net/question/2273217_217864" target="_blank" rel="noopener">https://www.oschina.net/question/2273217_217864</a><br><a href="http://www.cnblogs.com/yahokuma/p/3668138.html" target="_blank" rel="noopener">http://www.cnblogs.com/yahokuma/p/3668138.html</a>   </p>
<p><em>如有错误，请多指教</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/23/Java-init/" data-id="cjxo5fbdo0003skzzbycfsi9w" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lanChat" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/04/lanChat/" class="article-date">
  <time datetime="2018-08-03T16:00:00.000Z" itemprop="datePublished">2018-08-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/04/lanChat/">局域网聊天室</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h3><p>一个局域网内的聊天室，一个客户端发送了信息之后，服务端将其广播给当前连接的所有客户端。<br><img src="/img/lanchat.gif" alt></p>
<h3 id="服务端部分"><a href="#服务端部分" class="headerlink" title="服务端部分"></a>服务端部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Net;</span><br><span class="line">using System.Net.Sockets;</span><br><span class="line">using System.Threading;</span><br><span class="line"> </span><br><span class="line">namespace Unity聊天室服务端</span><br><span class="line">&#123;</span><br><span class="line">    class Client</span><br><span class="line">    &#123;</span><br><span class="line">        private Socket clientSkt;</span><br><span class="line">        private Thread t;</span><br><span class="line">        private byte[] rcvData;</span><br><span class="line">        private string massage;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        public Client(Socket client)</span><br><span class="line">        &#123;</span><br><span class="line">            this.clientSkt = client;</span><br><span class="line">            t = new Thread(ReceiveData);</span><br><span class="line">            t.Start();</span><br><span class="line">            rcvData = new byte[1024];</span><br><span class="line">            Console.WriteLine(&quot;一个客户端已连接&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        public bool Connected &#123; get &#123; return clientSkt.Connected; &#125; &#125;</span><br><span class="line">        /*connected返回的只是服务器是否断开和客户端的连接</span><br><span class="line">         *如果客户端单方断开了连接，这里的connected依然是true</span><br><span class="line">         * 所以要用poll来判断是否处于连通状态</span><br><span class="line">         */</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 接受客户端发来的信息，并调用广播方法</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private void ReceiveData()</span><br><span class="line">        &#123;</span><br><span class="line">            while (true)</span><br><span class="line">            &#123;</span><br><span class="line"> </span><br><span class="line">                if (clientSkt.Poll(10, SelectMode.SelectRead))</span><br><span class="line">                &#123;</span><br><span class="line"> </span><br><span class="line">                    Program.accptClientList.Remove(this);</span><br><span class="line">                    clientSkt.Close();</span><br><span class="line">                    Console.WriteLine(&quot;一条连接已中断&quot;);</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    int lenth = clientSkt.Receive(rcvData);</span><br><span class="line">                    massage = Encoding.UTF8.GetString(rcvData, 0, lenth);</span><br><span class="line">                    Console.WriteLine(&quot;服务端收到了一条消息：&quot; + massage);</span><br><span class="line">                    Program.BroadcastMsg(massage);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 发送消息给该客户端</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;msg&quot;&gt;&lt;/param&gt;</span><br><span class="line">        public void SendMsg(string msg)</span><br><span class="line">        &#123;</span><br><span class="line"> </span><br><span class="line">            clientSkt.Send(Encoding.UTF8.GetBytes(msg));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Net;</span><br><span class="line">using System.Net.Sockets;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line"> </span><br><span class="line">namespace Unity聊天室服务端</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    class Program</span><br><span class="line">    &#123;</span><br><span class="line">        public static List&lt;Client&gt; accptClientList = new List&lt;Client&gt;();</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 将msg广播给所有现在仍然连接的客户端</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;msg&quot;&gt;&lt;/param&gt;</span><br><span class="line">        public static void BroadcastMsg(string msg)</span><br><span class="line">        &#123;</span><br><span class="line">           </span><br><span class="line"> </span><br><span class="line">            /*foreach是只读模式，在里面不能删除自己，因为一旦删除，就会重新排序</span><br><span class="line">             * 比如原来的索引0被删除了，下一次foreach的索引0就会变成原来的1</span><br><span class="line">             * 1就会变成2，所以会报“集合已修改；可能无法执行枚举操作”的错误</span><br><span class="line">             */</span><br><span class="line"> </span><br><span class="line">            //foreach(Client clt in accptClientList)</span><br><span class="line">            //&#123;</span><br><span class="line">            //    if(clt.Connected)</span><br><span class="line">            //    &#123;</span><br><span class="line">            //        clt.SendMsg(msg);</span><br><span class="line">            //        Console.WriteLine(&quot;发送消息成功&quot;);</span><br><span class="line">            //    &#125;</span><br><span class="line">            //    else</span><br><span class="line">            //    &#123;</span><br><span class="line">            //        accptClientList.Remove(clt);</span><br><span class="line">            //    &#125;</span><br><span class="line">            //&#125;</span><br><span class="line">    </span><br><span class="line">            for (int i = 0; i &lt; accptClientList.Count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                accptClientList[i].SendMsg(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            Socket serveSkt = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line"> </span><br><span class="line">            //绑定ip和端口</span><br><span class="line">            serveSkt.Bind(new IPEndPoint(IPAddress.Parse(&quot;192.168.1.4&quot;), 10086));</span><br><span class="line"> </span><br><span class="line">            //开始监听消息</span><br><span class="line">            serveSkt.Listen(10);</span><br><span class="line">            Console.WriteLine(&quot;服务端正在运行&quot;);</span><br><span class="line"> </span><br><span class="line">            while (true)</span><br><span class="line">            &#123;</span><br><span class="line">                Socket client = serveSkt.Accept();</span><br><span class="line">                accptClientList.Add(new Client(client));</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Unity-部分"><a href="#Unity-部分" class="headerlink" title="Unity 部分"></a>Unity 部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using System.Net.Sockets;</span><br><span class="line">using System.Net;</span><br><span class="line">using System.Text;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line">using System.Threading;</span><br><span class="line"> </span><br><span class="line">public class ChatManage : MonoBehaviour &#123;</span><br><span class="line">    </span><br><span class="line">    private Socket client;</span><br><span class="line">    private Thread t;</span><br><span class="line">    private byte[] receiveMsg;</span><br><span class="line">    private byte[] sendMsg;</span><br><span class="line">    private string receiveSting;</span><br><span class="line"> </span><br><span class="line">    public InputField inputField;</span><br><span class="line">    public Button sendBtn;</span><br><span class="line">    public Text msgText;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    // Use this for initialization</span><br><span class="line">    void Start () &#123;</span><br><span class="line"> </span><br><span class="line">        sendMsg = new byte[1024];</span><br><span class="line">        receiveMsg = new byte[1024];</span><br><span class="line">        client = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">        client.Connect(new IPEndPoint(IPAddress.Parse(&quot;192.168.1.4&quot;), 10086));</span><br><span class="line">        </span><br><span class="line"> </span><br><span class="line">        t = new Thread(ReceiveMsg);</span><br><span class="line">        t.Start();</span><br><span class="line"> </span><br><span class="line">        /*</span><br><span class="line">         * receive不要写在主线程里面，不然服务端那边如果一直不传递消息过来的话</span><br><span class="line">         * 主线程就会一直堵塞</span><br><span class="line">         */</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	// Update is called once per frame</span><br><span class="line">	void Update () &#123;</span><br><span class="line">        Debug.Log(&quot;收到消息为&quot;+receiveSting);</span><br><span class="line">        if (receiveSting != &quot;&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            msgText.text += (&quot;\n&quot; + receiveSting);</span><br><span class="line">            receiveSting = &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    void ReceiveMsg()</span><br><span class="line">    &#123;</span><br><span class="line">        while (true)</span><br><span class="line">        &#123;</span><br><span class="line">            if (client.Connected)</span><br><span class="line">            &#123;</span><br><span class="line">                int lenth = client.Receive(receiveMsg);</span><br><span class="line">                receiveSting = Encoding.UTF8.GetString(receiveMsg, 0, lenth);</span><br><span class="line">            &#125;</span><br><span class="line">            else break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">public void OnSendBtn()</span><br><span class="line">    &#123;</span><br><span class="line">        if(inputField.text!=&quot;&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            sendMsg = Encoding.UTF8.GetBytes(inputField.text);</span><br><span class="line">            client.Send(sendMsg);</span><br><span class="line">            inputField.text = &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    private void OnDestroy()</span><br><span class="line">    &#123;</span><br><span class="line">        //t.Abort();</span><br><span class="line">        client.Shutdown(SocketShutdown.Both);</span><br><span class="line">        client.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/04/lanChat/" data-id="cjxo5fbe3000cskzz0dh1xh55" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity-网络/">-Unity -网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CF-Robot-Vacuum-Cleaner" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/18/CF-Robot-Vacuum-Cleaner/" class="article-date">
  <time datetime="2018-03-18T15:00:18.000Z" itemprop="datePublished">2018-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/18/CF-Robot-Vacuum-Cleaner/">CF Robot Vacuum Cleaner</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="题号"><a href="#题号" class="headerlink" title="题号"></a>题号</h3><p>CodeForces - 922D</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>s/h越大的越往前排，这样整体的字符串才是s/h值由大变小。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX=<span class="number">100005</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">T</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">int</span> sNum;</span><br><span class="line">	<span class="keyword">int</span> hNum;</span><br><span class="line">	<span class="keyword">float</span> sDh;</span><br><span class="line">	<span class="keyword">int</span> sh;</span><br><span class="line">&#125;tManager[MAX];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(T a,T b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a.sDh&gt;b.sDh;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> total,id=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> str[MAX];</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;total;</span><br><span class="line">	<span class="keyword">while</span>(id&lt;total)</span><br><span class="line">	&#123;</span><br><span class="line">	    <span class="built_in">cin</span>&gt;&gt;str;</span><br><span class="line">	    <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">while</span>(str[i]!=<span class="string">'\0'</span>)</span><br><span class="line">	    &#123;</span><br><span class="line">	    	<span class="keyword">if</span>(str[i]==<span class="string">'s'</span>)</span><br><span class="line">				tManager[id].sNum++;</span><br><span class="line">	    	<span class="keyword">else</span> <span class="keyword">if</span>(str[i]==<span class="string">'h'</span>)</span><br><span class="line">				&#123;</span><br><span class="line">	    	tManager[id].hNum++;</span><br><span class="line">				tManager[id].sh+=tManager[id].sNum;</span><br><span class="line">			  &#125;</span><br><span class="line">				i++;</span><br><span class="line">	    &#125;</span><br><span class="line">			<span class="keyword">if</span>(!tManager[id].hNum)</span><br><span class="line">			&#123;</span><br><span class="line">				tManager[id].sDh=MAX;<span class="comment">//s的数量与h的数量的比值最大有可能为99999；</span></span><br><span class="line">				<span class="comment">//所以用MAX就足够了</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">	    tManager[id].sDh=(<span class="keyword">float</span>)tManager[id].sNum/tManager[id].hNum;</span><br><span class="line">			id++;</span><br><span class="line">	&#125;</span><br><span class="line">	sort(tManager,tManager+id,cmp);</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>,sCot=<span class="number">0</span>;<span class="comment">//ans最大有可能是5w*5w，所以要用long long</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;id;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		ans+=sCot*tManager[i].hNum;</span><br><span class="line">		ans+=tManager[i].sh;</span><br><span class="line">		sCot+=tManager[i].sNum;</span><br><span class="line">	&#125;</span><br><span class="line">   <span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/03/18/CF-Robot-Vacuum-Cleaner/" data-id="cjxo5fbdg0001skzzffwpp2xv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">-algorithm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Unity-UGUI-Canvas" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/18/Unity-UGUI-Canvas/" class="article-date">
  <time datetime="2018-03-17T16:15:36.000Z" itemprop="datePublished">2018-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/18/Unity-UGUI-Canvas/">UGUI Canvas三种渲染模式及渲染顺序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="面板"><a href="#面板" class="headerlink" title="面板"></a>面板</h3><p><img src="/img/UGUI.jpg" alt></p>
<h3 id="RenderMode-分析"><a href="#RenderMode-分析" class="headerlink" title="RenderMode 分析"></a>RenderMode 分析</h3><h4 id="Screen-Space-Overlay"><a href="#Screen-Space-Overlay" class="headerlink" title="Screen Space-Overlay"></a>Screen Space-Overlay</h4><p>渲染到屏幕空间，覆盖模式，在所有 gameobjects 的上面 (类比手机贴膜)。<br>sort order：指的是前后顺序，1在0的前面，像order in layer，值越小越先渲染，值越大，越后渲染。(类比刷墙 - - )<br>在此模式下，不能改变 Rect Transform。</p>
<h4 id="Screen-Space-Camera"><a href="#Screen-Space-Camera" class="headerlink" title="Screen Space-Camera"></a>Screen Space-Camera</h4><p>渲染到屏幕空间，用摄像机来渲染。可以更改 Plane Distance 来更改画布到摄像机的距离。这个模式下 Rect Transform 也是锁定的。</p>
<h4 id="World-Space"><a href="#World-Space" class="headerlink" title="World Space"></a>World Space</h4><p>渲染到世界空间，UI 当成是 gameobject （类比道路指示牌）。<br>Event Camera 接收事件。<br>Sorting Layer 同上，用来控制渲染顺序，越往下的越靠前，Order In Layer 也用来改变渲染顺序，Sorting Layer 占据主导权，即在同一个Layer时，Order Ln Layer 才起作用。<br>这个模式下可以改变 Rect Transform。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/03/18/Unity-UGUI-Canvas/" data-id="cjxo5fbdx0008skzzklgynu1s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity/">Unity</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-longest-palindromic-substring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/16/longest-palindromic-substring/" class="article-date">
  <time datetime="2018-03-16T05:32:13.000Z" itemprop="datePublished">2018-03-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/16/longest-palindromic-substring/">最长回文子串</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="HDOJ3068"><a href="#HDOJ3068" class="headerlink" title="HDOJ3068"></a>HDOJ3068</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt; </span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX=<span class="number">110005</span>;</span><br><span class="line"><span class="keyword">char</span> s1[MAX];</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">2</span>*MAX+<span class="number">2</span>];<span class="comment">//增加MAX+1个‘#’和一个‘$’ </span></span><br><span class="line"><span class="keyword">int</span> d[<span class="number">2</span>*MAX+<span class="number">2</span>];</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;s1)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">memset</span>(d,<span class="number">0</span>,<span class="keyword">sizeof</span>(d));</span><br><span class="line">		<span class="built_in">memset</span>(s,<span class="number">0</span>,<span class="keyword">sizeof</span>(s));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//字符串预处理 </span></span><br><span class="line">	   <span class="keyword">int</span> ans=<span class="number">1</span>;</span><br><span class="line">	   <span class="keyword">int</span> len=<span class="built_in">strlen</span>(s1);</span><br><span class="line">	   s[<span class="number">0</span>]=<span class="string">'&amp;'</span>;</span><br><span class="line">	   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*len+<span class="number">1</span>;i+=<span class="number">2</span>)</span><br><span class="line">	   &#123;</span><br><span class="line">	   	s[i]=<span class="string">'#'</span>;</span><br><span class="line">	   &#125;</span><br><span class="line">	   <span class="keyword">int</span> k=<span class="number">0</span>;</span><br><span class="line">	   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=<span class="number">2</span>*len;i+=<span class="number">2</span>)</span><br><span class="line">	   &#123;</span><br><span class="line">	   	s[i]=s1[k++];</span><br><span class="line">	   &#125;</span><br><span class="line">	   </span><br><span class="line">	   <span class="comment">//debug</span></span><br><span class="line">	   <span class="comment">/*for(int i=0;i&lt;strlen(s);i++)</span></span><br><span class="line"><span class="comment">	   &#123;</span></span><br><span class="line"><span class="comment">	   	cout&lt;&lt;s[i]&lt;&lt;" ";</span></span><br><span class="line"><span class="comment">	   &#125;</span></span><br><span class="line"><span class="comment">	   cout&lt;&lt;endl;*/</span></span><br><span class="line">	   </span><br><span class="line">	   </span><br><span class="line">	   </span><br><span class="line">	   <span class="keyword">int</span> id=<span class="number">0</span>,mx=<span class="number">0</span>;</span><br><span class="line">	   d[<span class="number">0</span>]=<span class="number">1</span>;d[<span class="number">1</span>]=<span class="number">1</span>;d[<span class="number">2</span>]=<span class="number">2</span>;</span><br><span class="line">	   <span class="comment">//mx是以id为中心的回文字串的右边缘（不在字串内） </span></span><br><span class="line">	   <span class="comment">//id是已知的回文字串中，右边缘最靠右的子串的中心</span></span><br><span class="line">	   id=<span class="number">2</span>;mx=id+d[id];</span><br><span class="line">	   </span><br><span class="line">	   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">3</span>;s[i]!=<span class="string">'\0'</span>;i++)</span><br><span class="line">	   &#123;</span><br><span class="line">	   	</span><br><span class="line">	   	<span class="comment">//j是i关于id的对称点</span></span><br><span class="line">	   	<span class="keyword">int</span> j=<span class="number">2</span>*id-i;</span><br><span class="line">	   	</span><br><span class="line">	   	<span class="comment">//当i&lt;mx,d[i]&gt;=min(mx-i,d[j]) </span></span><br><span class="line">	   	<span class="keyword">if</span>(i&lt;mx)</span><br><span class="line">	   	&#123;</span><br><span class="line">			<span class="keyword">if</span>(d[j]&lt;mx-i)</span><br><span class="line">			&#123;</span><br><span class="line">				d[i]=d[j];</span><br><span class="line">			&#125;  </span><br><span class="line">		  </span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				d[i]=mx-i;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//当i&gt;=mx的时候，的d[i]=1; </span></span><br><span class="line">		<span class="keyword">else</span> d[i]=<span class="number">1</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		上13行可写成d[i]=i&lt;mx?min(d[2*id-i],mx-i):1; </span></span><br><span class="line"><span class="comment">		*/</span> </span><br><span class="line">		</span><br><span class="line">		<span class="comment">//确定了d[i]的最小值之后，超出部分逐个比较 </span></span><br><span class="line">		<span class="keyword">while</span>(s[i+d[i]]==s[i-d[i]])</span><br><span class="line">			d[i]++;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//更新id，mx的值 </span></span><br><span class="line">		<span class="keyword">if</span>(i+d[i]&gt;mx)</span><br><span class="line">		&#123;</span><br><span class="line">			mx=i+d[i];</span><br><span class="line">			id=i;</span><br><span class="line">		&#125;</span><br><span class="line">	   </span><br><span class="line">        <span class="comment">//更新最大值 </span></span><br><span class="line">		<span class="keyword">if</span>(d[i]<span class="number">-1</span>&gt;ans)</span><br><span class="line">		ans=d[i]<span class="number">-1</span>;</span><br><span class="line">	   &#125; </span><br><span class="line">	   </span><br><span class="line">	   <span class="comment">//输出答案 </span></span><br><span class="line">	   <span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LeetCode-Longest-Palindromic-Substring"><a href="#LeetCode-Longest-Palindromic-Substring" class="headerlink" title="LeetCode: Longest Palindromic Substring"></a>LeetCode: Longest Palindromic Substring</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">longestPalindrome</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">char</span> pad=<span class="string">'#'</span>;</span><br><span class="line">    <span class="keyword">int</span> len=s.length();</span><br><span class="line">    <span class="keyword">int</span> total_len=<span class="number">2</span>*len+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span>* cstr=<span class="keyword">new</span> <span class="keyword">char</span>[total_len];</span><br><span class="line">    <span class="keyword">int</span>* rcd =<span class="keyword">new</span> <span class="keyword">int</span>[total_len];<span class="comment">//记录以index为中心的最长回文子串长度</span></span><br><span class="line">    cstr[<span class="number">0</span>]=pad;</span><br><span class="line">    <span class="keyword">int</span> k=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      cstr[k++]=s[i];</span><br><span class="line">      cstr[k++]=pad;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> max_index=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;total_len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      rcd[i]=<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> j=i/<span class="number">2</span>;j&lt;i;j++)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">2</span>*j-i&lt;<span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(rcd[j]==i-j&amp;&amp;cstr[<span class="number">2</span>*j-i]==cstr[i])</span><br><span class="line">        rcd[j]++;</span><br><span class="line">        <span class="keyword">if</span>(rcd[j]&gt;rcd[max_index])</span><br><span class="line">        max_index=j;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> sb=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//起始位置的下标</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> t=max_index-rcd[max_index]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=t;i&lt;=<span class="number">2</span>*max_index-t;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>(cstr[i]!=pad)</span><br><span class="line">      <span class="comment">//append会运行错</span></span><br><span class="line">      <span class="comment">//sb.append(cstr,i,1);</span></span><br><span class="line">          sb+=cstr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/03/16/longest-palindromic-substring/" data-id="cjxo5fbea000eskzz19blr9gn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/">LeetCode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-OS/">-Java -OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Pattern/">-Java -Pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-网络/">-Java -网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity-网络/">-Unity -网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">-algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络/">-网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/">LeetCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/english/">english</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reading/">reading</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/record/">record</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java-OS/" style="font-size: 10px;">-Java -OS</a> <a href="/tags/Java-Pattern/" style="font-size: 10px;">-Java -Pattern</a> <a href="/tags/Java-网络/" style="font-size: 10px;">-Java -网络</a> <a href="/tags/Unity-网络/" style="font-size: 10px;">-Unity -网络</a> <a href="/tags/algorithm/" style="font-size: 10px;">-algorithm</a> <a href="/tags/网络/" style="font-size: 10px;">-网络</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/LeetCode/" style="font-size: 10px;">LeetCode</a> <a href="/tags/Unity/" style="font-size: 20px;">Unity</a> <a href="/tags/algorithm/" style="font-size: 20px;">algorithm</a> <a href="/tags/english/" style="font-size: 10px;">english</a> <a href="/tags/reading/" style="font-size: 10px;">reading</a> <a href="/tags/record/" style="font-size: 10px;">record</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/07/04/latter1/">Letter from an Unknown Woman</a>
          </li>
        
          <li>
            <a href="/2019/06/24/TCP-IP-1/">《TCP/IP 详解》whois 试验</a>
          </li>
        
          <li>
            <a href="/2019/06/12/flush-problem/">BufferedOutputStream 和 OutputStream</a>
          </li>
        
          <li>
            <a href="/2019/04/26/singleton/">单例模式</a>
          </li>
        
          <li>
            <a href="/2019/04/25/producer-and-consumer/">生产者消费者问题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>