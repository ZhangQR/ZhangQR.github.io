<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Record my life and progress(maybe)">
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        关于析构的无聊小实验 - ZhangQR的博客 | ZhangQR&#39;s Blog
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> A game,a show or a sing. </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>zhangqr</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#喵？"><span class="toc-text">喵？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#delete-干了啥"><span class="toc-text">delete 干了啥~</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#继续探索"><span class="toc-text">继续探索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#先睡了，有时间看看虚函数表是怎么实现的估计会有新发现"><span class="toc-text">先睡了，有时间看看虚函数表是怎么实现的估计会有新发现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#遗留问题"><span class="toc-text">遗留问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#神秘偏移"><span class="toc-text">神秘偏移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基类直接引用"><span class="toc-text">基类直接引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0xfeeefeee-已解决"><span class="toc-text">0xfeeefeee(已解决)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cannot-access-memory-at-address"><span class="toc-text">Cannot access memory at address</span></a></li></ol></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> A game,a show or a sing. </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        关于析构的无聊小实验
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2020-01-01 11:26:48</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#c++" title="c++">c++</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#experiment" title="experiment">experiment</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h1 id="喵？"><a href="#喵？" class="headerlink" title="喵？"></a>喵？</h1><h2 id="delete-干了啥"><a href="#delete-干了啥" class="headerlink" title="delete 干了啥~"></a>delete 干了啥~</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *hh = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">delete</span> hh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p hh # int *hh = new int(5); 未执行</span><br><span class="line">$1 = (int *) 0x400080</span><br><span class="line">(gdb) p &amp;hh</span><br><span class="line">$2 = (int **) 0x29ff2c</span><br><span class="line">(gdb) p *hh</span><br><span class="line">$3 = 17744</span><br><span class="line">(gdb) n </span><br><span class="line">87	    delete hh; </span><br><span class="line">(gdb) p hh # int *hh = new int(5); 执行了</span><br><span class="line">$4 = (int *) 0xdf11a8</span><br><span class="line">(gdb) p *hh</span><br><span class="line">$5 = 5</span><br><span class="line">(gdb) p &amp;hh</span><br><span class="line">$6 = (int **) 0x29ff2c</span><br><span class="line">(gdb) n</span><br><span class="line">88	&#125;</span><br><span class="line">(gdb) p hh  # delete hh; 执行了</span><br><span class="line">$7 = (int *) 0xdf11a8</span><br><span class="line">(gdb) p &amp;hh</span><br><span class="line">$8 = (int **) 0x29ff2c</span><br><span class="line">(gdb) p *hh</span><br><span class="line">$9 = 14618544</span><br></pre></td></tr></table></figure>

<p>分析(瞎): hh 的地址在 hh 没定义之前就存在了，因为是用clion直接加断点然后开debug，所以看这个现象会比较奇怪，但其实如果自己编译的话，应该是知道要先编一个debug版本，在用gdb调试，所以在用gdb的时候，该有的符号就已经存在了。<br>可见下面的小程序哈</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">miao</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> miaoo = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *hh = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">delete</span> hh;</span><br><span class="line">    <span class="keyword">int</span> xixi = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在入口时，gdb显示如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p miaoo</span><br><span class="line">No symbol &quot;miaoo&quot; in current context.</span><br><span class="line">(gdb) p miao</span><br><span class="line">$1 = &#123;int (void)&#125; 0x401410 &lt;miao()&gt;</span><br><span class="line">(gdb) p xixi</span><br><span class="line">$2 = 2147344384</span><br><span class="line">(gdb) p wangwang</span><br><span class="line">No symbol &quot;wangwang&quot; in current context.</span><br></pre></td></tr></table></figure>

<p>第二个现象：delete之后，hh的地址不变，hh的值(存储的地址)不变，但hh存的那块地址的值变了？？一开始我还挺奇怪的，因为如果我是一个计算机，对delete最理想的处理方式应该是，一旦hh被delete了，那么后面再有用到hh的地方就是异常的，也就是hh这个symbol就应该彻底被消灭。但仔细想想话，这有点“强机所难”了，因为对计算机来说，是不存在hh这个东西的，他只是按照指令来将数据在内存，寄存器和IO中进行传输。那么我刚刚的构想可以理解为，一旦hh被delete，那么再用到 0xdf11a8 这块地址就是异常的，那。。这不是系统性的内存泄漏嘛(笑)。这样一想，我倒是能理解为什么delete选择对 0xdf11a8 这块内存的数据动手了，而且也不能不动手，因为delete就是希望不再让人获得原数据；而且也不能全部刷新为 0，出了问题比较难debug吧。<br>真是难为编译器的用心良苦了喵~！</p>
<h2 id="继续探索"><a href="#继续探索" class="headerlink" title="继续探索"></a>继续探索</h2><p>测试代码就是酱紫啦，主要的目的是探索如果基类的析构函数不是virtual的，就不会调用子类的析构函数，那么怎么能再次使用子类的成员嘞？(感觉自己离黑客又近了一步呐)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseClass</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    BaseClass()</span><br><span class="line">            : m_pValue(<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*virtual*/</span> ~BaseClass()</span><br><span class="line">   <span class="comment">// virtual ~BaseClass()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> m_pValue;</span><br><span class="line">        m_pValue = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"BaseClass virtual construct."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetValue</span><span class="params">(<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!m_pValue)</span><br><span class="line">        &#123;</span><br><span class="line">            m_pValue = <span class="keyword">new</span> <span class="keyword">int</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            *m_pValue = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* m_pValue;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubClass</span> :</span> <span class="keyword">public</span> BaseClass</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    SubClass()</span><br><span class="line">            : BaseClass()</span><br><span class="line">            , m_pstrName(<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*virtual*/</span> ~SubClass()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> m_pstrName;</span><br><span class="line">        m_pstrName = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"SubClass virtual construct."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetName</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!m_pstrName)</span><br><span class="line">        &#123;</span><br><span class="line">            m_pstrName = <span class="keyword">new</span> <span class="built_in">std</span>::<span class="built_in">string</span>(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            *m_pstrName = <span class="built_in">std</span>::<span class="built_in">string</span>(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> *<span class="title">get_string</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m_pstrName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>* m_pstrName;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BaseClass* pObj = <span class="keyword">new</span> SubClass();</span><br><span class="line">    pObj-&gt;SetValue(<span class="number">10</span>);</span><br><span class="line">    ((SubClass*)pObj)-&gt;SetName(<span class="string">"zhangsan"</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;*(((SubClass*)pObj)-&gt;get_string())&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">delete</span> pObj;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;*(((SubClass*)pObj)-&gt;get_string())&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    pObj = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基类的析构函数不是virtual的情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p pObj # 没有 delete 之前</span><br><span class="line">$1 = (BaseClass *) 0xd311a8</span><br><span class="line">(gdb) p pObj-&gt;m_pstrName</span><br><span class="line">There is no member or method named m_pstrName.</span><br><span class="line">(gdb) p ((SubClass*)pObj)-&gt;m_pstrName</span><br><span class="line">$2 = 0xd311e8</span><br><span class="line">(gdb) p *(((SubClass*)pObj)-&gt;m_pstrName)</span><br><span class="line">$3 = &quot;zhangsan&quot;</span><br><span class="line">(gdb) x/64cb 0xd311e8 # 按单字节，字符形式打印64个单位</span><br><span class="line">0xd311e8:	-16 &apos;\360&apos;	17 &apos;\021&apos;	-45 &apos;\323&apos;	0 &apos;\000&apos;	8 &apos;\b&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd311f0:	122 &apos;z&apos;	104 &apos;h&apos;	97 &apos;a&apos;	110 &apos;n&apos;	103 &apos;g&apos;	115 &apos;s&apos;	97 &apos;a&apos;	110 &apos;n&apos;</span><br><span class="line">0xd311f8:	0 &apos;\000&apos;	-16 &apos;\360&apos;	-83 &apos;\255&apos;	-70 &apos;\272&apos;	13 &apos;\r&apos;	-16 &apos;\360&apos;	-83 &apos;\255&apos;	-70 &apos;\272&apos;</span><br><span class="line">0xd31200:	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;</span><br><span class="line">0xd31208:	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd31210:	-19 &apos;\355&apos;	-103 &apos;\231&apos;	-110 &apos;\222&apos;	80 &apos;P&apos;	-42 &apos;\326&apos;	-91 &apos;\245&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd31218:	40 &apos;(&apos;	127 &apos;\177&apos;	-45 &apos;\323&apos;	0 &apos;\000&apos;	-40 &apos;\330&apos;	18 &apos;\022&apos;	-45 &apos;\323&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd31220:	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;</span><br><span class="line">(gdb) p pObj-&gt;m_pValue</span><br><span class="line">$4 = (int *) 0xd311c8</span><br><span class="line">(gdb) p *(pObj-&gt;m_pValue)</span><br><span class="line">$5 = 10</span><br><span class="line">(gdb) x/64dw 0xd311c8 # 按4字节，十进制的形式打印64个单位</span><br><span class="line">0xd311c8:	10	-1414812757	-1414812757	-17891602</span><br><span class="line">0xd311d8:	0	0	1100061183	402695636</span><br><span class="line">0xd311e8:	13832688	8	1851877498	1851880295</span><br><span class="line">0xd311f8:	-1163005952	-1163005939	-1414812757	-1414812757</span><br><span class="line">0xd31208:	0	0	1351784941	42454</span><br><span class="line">0xd31218:	13860648	13832920	-17891602	-17891602</span><br><span class="line">0xd31228:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31238:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31248:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31258:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31268:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31278:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31288:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31298:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd312a8:	-17891602	-17891602	1133615613	436250052</span><br><span class="line">0xd312b8:	2	-1414856637	-1414812757	-17912917</span><br><span class="line">(gdb) n</span><br><span class="line">79	    std::cout&lt;&lt;*(((SubClass*)pObj)-&gt;get_string())&lt;&lt;std::endl;</span><br><span class="line">(gdb) p pObj # delete 之后</span><br><span class="line">$6 = (BaseClass *) 0xd311a8</span><br><span class="line">(gdb) p pObj-&gt;m_pstrName</span><br><span class="line">There is no member or method named m_pstrName.</span><br><span class="line">(gdb) p ((SubClass*)pObj)-&gt;m_pstrName</span><br><span class="line">$7 = 0xd312d8</span><br><span class="line">(gdb) p *(((SubClass*)pObj)-&gt;m_pstrName)</span><br><span class="line">$8 = &quot;\030\022\323\000\330\022\323\000\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\377\231\221A\330\245\000\030\360\021\323\000\b\000\000\000zhangsan\000\360\255\272\r\360\255\272\253\253\253\253\253\253\253\253\000\000\000\000\000\000\000\000\355\231\222P\326\245\000\000(\177\323\000\250\021\323\000\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\356\376\375\231\221C\304\245\000\032\002\000\000\000C\000\253\253\253\253\253\253\253\253\356\376\000\000\000\000\000\000\000\000\372\231\222G\324\245\000\000\250\021\323\000\300\000\323\000\356\376\356\376\356\376\356\376\276\231\221\000\323\245\000\030\002\000\000\000\250\003\000\000\001\000\000\000\004\b\000\000\301\243\332\243 \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\b\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\030\b\b\b\b\b\b((((((((((((((((((((((((((\b\b\b\b\b\b\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000abcdefghijklmnopqrstuvwxyz\000\000\000\000\000\000ABCDEFGHIJKLMNOPQRSTUVWXYZ\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\253\253\253\253\253\253\253\253\000\000\000\000\000\000\000\000\035\231\221\243\227\245\000\035\330\025\323\000\367\025\323\000 \026\323\000=\026\323\000H\026\323\000\204\026\323\000\273\026\323\000\354\026\323\000\t\027\323\000-\027\323\000^\027\323\000\206\027\323\000\223\027\323\000\253\027\323\000\330\027\323\000\341\027\323\000\r\030\323\000+\030\323\000B\030\323\000e\030\323\000s\030\323\000V\031\323\000\224\031\323\000\257\031\323\000\314\031\323\000\024\032\323\000&quot;...</span><br><span class="line">(gdb) x/64cb 0xd311e8</span><br><span class="line">0xd311e8:	-16 &apos;\360&apos;	17 &apos;\021&apos;	-45 &apos;\323&apos;	0 &apos;\000&apos;	8 &apos;\b&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd311f0:	122 &apos;z&apos;	104 &apos;h&apos;	97 &apos;a&apos;	110 &apos;n&apos;	103 &apos;g&apos;	115 &apos;s&apos;	97 &apos;a&apos;	110 &apos;n&apos;</span><br><span class="line">0xd311f8:	0 &apos;\000&apos;	-16 &apos;\360&apos;	-83 &apos;\255&apos;	-70 &apos;\272&apos;	13 &apos;\r&apos;	-16 &apos;\360&apos;	-83 &apos;\255&apos;	-70 &apos;\272&apos;</span><br><span class="line">0xd31200:	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;</span><br><span class="line">0xd31208:	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd31210:	-19 &apos;\355&apos;	-103 &apos;\231&apos;	-110 &apos;\222&apos;	80 &apos;P&apos;	-42 &apos;\326&apos;	-91 &apos;\245&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd31218:	40 &apos;(&apos;	127 &apos;\177&apos;	-45 &apos;\323&apos;	0 &apos;\000&apos;	-88 &apos;\250&apos;	17 &apos;\021&apos;	-45 &apos;\323&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd31220:	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;</span><br><span class="line">(gdb) p pObj-&gt;m_pValue</span><br><span class="line">$9 = (int *) 0xd31218</span><br><span class="line">(gdb) p *(pObj-&gt;m_pValue)</span><br><span class="line">$10 = 13860648</span><br><span class="line">(gdb) x/64dw 0xd311c8</span><br><span class="line">0xd311c8:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd311d8:	-17891602	-17891602	1100061183	402695640</span><br><span class="line">0xd311e8:	13832688	8	1851877498	1851880295</span><br><span class="line">0xd311f8:	-1163005952	-1163005939	-1414812757	-1414812757</span><br><span class="line">0xd31208:	0	0	1351784941	42454</span><br><span class="line">0xd31218:	13860648	13832616	-17891602	-17891602</span><br><span class="line">0xd31228:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31238:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31248:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31258:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31268:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd31278:	-17891602	-17891602	-17891602	-17891602</span><br></pre></td></tr></table></figure>

<p>可以看到，如果基类的析构函数不是virtual，那么在多态的时候就不会调用子类的析构函数，所以0xd311f0这块内存是没有被刷新的，理论上来说，p <em>(((SubClass</em>)pObj)-&gt;m_pstrName) 依然能够得到“zhangsan”才对，但是可以看到p出来的是却是0xd311e8的前面的很长一段内存到很大的内存地址。(挠头)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0xd311e0:	-1 &apos;\377&apos;	-103 &apos;\231&apos;	-111 &apos;\221&apos;	65 &apos;A&apos;	-40 &apos;\330&apos;	-91 &apos;\245&apos;	0 &apos;\000&apos;	24 &apos;\030&apos;</span><br><span class="line">0xd311e8:	-16 &apos;\360&apos;	17 &apos;\021&apos;	-45 &apos;\323&apos;	0 &apos;\000&apos;	8 &apos;\b&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos; # 对应 p *(((SubClass*)pObj)-&gt;m_pstrName) 结果的“zhangsan”前面那一段数据</span><br><span class="line">0xd311f0:	122 &apos;z&apos;	104 &apos;h&apos;	97 &apos;a&apos;	110 &apos;n&apos;	103 &apos;g&apos;	115 &apos;s&apos;	97 &apos;a&apos;	110 &apos;n&apos;</span><br></pre></td></tr></table></figure>

<p>嘛。。估计就是一种保护机制吧，目前为止情况还在控制之中(起码还能自己骗过自己。。。)</p>
<p>基类的析构函数加上 virtual 的情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">(gdb)  p pObj</span><br><span class="line">$4 = (SubClass *) 0xd611a8</span><br><span class="line">(gdb) p pObj-&gt;m_pstrName</span><br><span class="line">$5 = 0xd611f0</span><br><span class="line">(gdb) p ((SubClass*)pObj)-&gt;m_pstrName</span><br><span class="line">$6 = 0xd611f0</span><br><span class="line">(gdb) p *(pObj-&gt;m_pstrName)</span><br><span class="line">$7 = &quot;zhangsan&quot;</span><br><span class="line">(gdb) p *(((SubClass*)pObj)-&gt;m_pstrName)</span><br><span class="line">$8 = &quot;zhangsan&quot;</span><br><span class="line">(gdb) x/64cb 0xd611f0</span><br><span class="line">0xd611f0:	-8 &apos;\370&apos;	17 &apos;\021&apos;	-42 &apos;\326&apos;	0 &apos;\000&apos;	8 &apos;\b&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd611f8:	122 &apos;z&apos;	104 &apos;h&apos;	97 &apos;a&apos;	110 &apos;n&apos;	103 &apos;g&apos;	115 &apos;s&apos;	97 &apos;a&apos;	110 &apos;n&apos;</span><br><span class="line">0xd61200:	0 &apos;\000&apos;	-16 &apos;\360&apos;	-83 &apos;\255&apos;	-70 &apos;\272&apos;	13 &apos;\r&apos;	-16 &apos;\360&apos;	-83 &apos;\255&apos;	-70 &apos;\272&apos;</span><br><span class="line">0xd61208:	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;	-85 &apos;\253&apos;</span><br><span class="line">0xd61210:	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd61218:	-43 &apos;\325&apos;	21 &apos;\025&apos;	23 &apos;\027&apos;	-5 &apos;\373&apos;	-62 &apos;\302&apos;	-54 &apos;\312&apos;	0 &apos;\000&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd61220:	40 &apos;(&apos;	127 &apos;\177&apos;	-42 &apos;\326&apos;	0 &apos;\000&apos;	-40 &apos;\330&apos;	18 &apos;\022&apos;	-42 &apos;\326&apos;	0 &apos;\000&apos;</span><br><span class="line">0xd61228:	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;	-18 &apos;\356&apos;	-2 &apos;\376&apos;</span><br><span class="line">(gdb) p pObj-&gt;m_pValue</span><br><span class="line">$9 = (int *) 0xd611d0</span><br><span class="line">(gdb) p *(pObj-&gt;m_pValue)</span><br><span class="line">$10 = 10</span><br><span class="line">(gdb) x/64dw 0xd611d0</span><br><span class="line">0xd611d0:	10	-1414812757	-1414812757	-17891602</span><br><span class="line">0xd611e0:	0	0	-317450816	402705088</span><br><span class="line">0xd611f0:	14029304	8	1851877498	1851880295</span><br><span class="line">0xd61200:	-1163005952	-1163005939	-1414812757	-1414812757</span><br><span class="line">0xd61210:	0	0	-82373163	51906</span><br><span class="line">0xd61220:	14057256	14029528	-17891602	-17891602</span><br><span class="line">0xd61230:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61240:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61250:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61260:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61270:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61280:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61290:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd612a0:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd612b0:	-283896382	436259543	2	-1414856637</span><br><span class="line">0xd612c0:	-1414812757	-17912917	0	0</span><br><span class="line">(gdb) n</span><br><span class="line">79	    std::cout&lt;&lt;*(((SubClass*)pObj)-&gt;get_string())&lt;&lt;std::endl;</span><br><span class="line">(gdb) p pObj</span><br><span class="line">$11 = (BaseClass *) 0xd611a8</span><br><span class="line">(gdb) p pObj-&gt;m_pstrName</span><br><span class="line">There is no member or method named m_pstrName.</span><br><span class="line">(gdb) p ((SubClass*)pObj)-&gt;m_pstrName</span><br><span class="line">$12 = (std::__cxx11::string *) 0xfeeefeee</span><br><span class="line">(gdb) p *(((SubClass*)pObj)-&gt;m_pstrName)</span><br><span class="line">Cannot access memory at address 0xfeeefeee</span><br><span class="line">(gdb) x/64cb 0xd311e8</span><br><span class="line">0xd311e8:	Cannot access memory at address 0xd311e8</span><br><span class="line">(gdb) x/64cb 0xfeeefeee</span><br><span class="line">0xfeeefeee:	Cannot access memory at address 0xfeeefeee</span><br><span class="line">(gdb) p pObj-&gt;m_pValue</span><br><span class="line">$13 = (int *) 0xd67f28</span><br><span class="line">(gdb) p *(pObj-&gt;m_pValue)</span><br><span class="line">$14 = 14029224</span><br><span class="line">(gdb) x/64dw 0xd611d0</span><br><span class="line">0xd611d0:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd611e0:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd611f0:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61200:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61210:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61220:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61230:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61240:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61250:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61260:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61270:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61280:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd61290:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd612a0:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd612b0:	-283896382	436259558	2	-1414856637</span><br><span class="line">0xd612c0:	-1414812757	-17912917	0	0</span><br><span class="line">(gdb) x/64dw 0xd67f28</span><br><span class="line">0xd67f28:	14029224	14029528	-17891602	-17891602</span><br><span class="line">0xd67f38:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67f48:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67f58:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67f68:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67f78:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67f88:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67f98:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67fa8:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67fb8:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67fc8:	-17891602	-17891602	-17891602	-17891602</span><br><span class="line">0xd67fd8:	-17891602	-17891602	-384690750	50383580</span><br><span class="line">0xd67fe8:	14024844	14024844	14024760	14024760</span><br><span class="line">0xd67ff8:	14057472	28672	Cannot access memory at address 0xd68000</span><br></pre></td></tr></table></figure>

<p>加上虚函数之后，情况就有点不受控制了，首先是基类指针不用转成子类就可以直接引用子类成员变量；二是析构时基类子类的成员变量都指向了其他内存，在没有加入虚函数时只是刷新指向的那块内存的数据哦~地址本身是不变滴。更诡异的是，实验两次，析构后那个字符串的地址都是0xfeeefeee，int的地址却每次都不同。</p>
<h2 id="先睡了，有时间看看虚函数表是怎么实现的估计会有新发现"><a href="#先睡了，有时间看看虚函数表是怎么实现的估计会有新发现" class="headerlink" title="先睡了，有时间看看虚函数表是怎么实现的估计会有新发现"></a>先睡了，有时间看看虚函数表是怎么实现的估计会有新发现</h2><h2 id="遗留问题"><a href="#遗留问题" class="headerlink" title="遗留问题"></a>遗留问题</h2><h3 id="神秘偏移"><a href="#神秘偏移" class="headerlink" title="神秘偏移"></a>神秘偏移</h3><p>在没有虚函数的时候，delete 之后<code>p (((SubClass)pObj)-&gt;m_pstrName)</code> 的结果有一段很奇怪的偏移。。</p>
<h3 id="基类直接引用"><a href="#基类直接引用" class="headerlink" title="基类直接引用"></a>基类直接引用</h3><p>加上虚函数之后，基类指针不用转成子类就可以直接引用子类成员变量，delete 之后就不可以啦</p>
<h3 id="0xfeeefeee-已解决"><a href="#0xfeeefeee-已解决" class="headerlink" title="0xfeeefeee(已解决)"></a>0xfeeefeee(已解决)</h3><p>长得奇怪，必有猫腻</p>
<hr>
<blockquote>
<p>0xcccccccc : Used by Microsoft’s C++ debugging runtime library to mark uninitialised stack memory<br>0xcdcdcdcd : Used by Microsoft’s C++ debugging runtime library to mark uninitialised heap memory<br>0xfeeefeee : Used by Microsoft’s HeapFree() to mark freed heap memory<br>0xabababab : Used by Microsoft’s HeapAlloc() to mark “no man’s land” guard bytes after allocated heap memory<br>0xabadcafe : A startup to this value to initialize all free memory to catch errant pointers<br>0xbaadf00d : Used by Microsoft’s LocalAlloc(LMEM_FIXED) to mark uninitialised allocated heap memory<br>0xbadcab1e : Error Code returned to the Microsoft eVC debugger when connection is severed to the debugger<br>0xbeefcace : Used by Microsoft .NET as a magic number in resource files<br>对于0xcccccccc和0xcdcdcdcd，在 Debug 模式下，VC 会把未初始化的栈内存上的指针全部填成 0xcccccccc ，当字符串看就是 “烫烫烫烫……”；会把未初始化的堆内存上的指针全部填成 0xcdcdcdcd，当字符串看就是 “屯屯屯屯……”。那么调试器为什么要这么做呢？VC的DEBUG版会把未初始化的指针自动初始化为0xcccccccc或0xcdcdcdcd，而不是就让取随机值，那是为了方便我们调试程序，如果野指针的初值不确定，那么每次调试同一个程序就可能出现不一样的结果，比如这次程序崩掉，下次却能正常运行，这样显然对我们解bug是非常不利的，所以自动初始化的目的是为了让我们一眼就能确定我们使用了未初始化的野指针了。<br>对于0xfeeefeee，是用来标记堆上已经释放掉的内存。注意，如果指针指向的内存被释放了，变量变量本身的地址如未做改动，还是之前指向的内存的地址。如果该指针是一个类的指针，并且类中包含有指针变量，则内存被释放后（对于C++类，通常是执行delete操作），类中的指针变量就会被赋值为0xfeeefeee。如果早调试代码过程中，发现有值为0xfeeefeee的指针，就说明对应的内存被释放掉了，我们的代码已经出问题了。</p>
</blockquote>
<h3 id="Cannot-access-memory-at-address"><a href="#Cannot-access-memory-at-address" class="headerlink" title="Cannot access memory at address"></a>Cannot access memory at address</h3><p>当我以为可以用gdb p 出内存的全部地址数据的时候。。<code>Cannot access memory at address</code>真是狠狠打脸了呐，所以能访问的地址有什么条件咧？<br>猜测：能p出来的都是存在物理内存中的，但 <code>0xd67ff8:    14057472    28672    Cannot access memory at address 0xd68000</code>有点说不过去啊。。</p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        
        <li>
            <a target="_blank" href="http://weibo.com/烂醉花间Dlitf">
                            <span class="fa-stack fa-lg">
                                  <i class="iconfont icon-weibo"></i>
                            </span>
            </a>
        </li>
        

        

        
        <li>
            <a target="_blank"  href="https://github.com/ZhangQR">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
